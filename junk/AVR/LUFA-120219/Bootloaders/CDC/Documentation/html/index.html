<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>LUFA Library - CDC Class Bootloader: CDC Class USB AVR Bootloader</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript">
$(document).ready(initResizable);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.3 -->
<script type="text/javascript">
function hasClass(ele,cls) {
  return ele.className.match(new RegExp('(\\s|^)'+cls+'(\\s|$)'));
}

function addClass(ele,cls) {
  if (!this.hasClass(ele,cls)) ele.className += " "+cls;
}

function removeClass(ele,cls) {
  if (hasClass(ele,cls)) {
    var reg = new RegExp('(\\s|^)'+cls+'(\\s|$)');
    ele.className=ele.className.replace(reg,' ');
  }
}

function toggleVisibility(linkObj) {
 var base = linkObj.getAttribute('id');
 var summary = document.getElementById(base + '-summary');
 var content = document.getElementById(base + '-content');
 var trigger = document.getElementById(base + '-trigger');
 if ( hasClass(linkObj,'closed') ) {
   summary.style.display = 'none';
   content.style.display = 'block';
   trigger.src = 'open.png';
   removeClass(linkObj,'closed');
   addClass(linkObj,'opened');
 } else if ( hasClass(linkObj,'opened') ) {
   summary.style.display = 'block';
   content.style.display = 'none';
   trigger.src = 'closed.png';
   removeClass(linkObj,'opened');
   addClass(linkObj,'closed');
 }
 return false;
}
</script>
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">LUFA Library - CDC Class Bootloader&#160;<span id="projectnumber">0.0.0</span></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li class="current"><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('index.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<h1>CDC Class USB AVR Bootloader </h1>  </div>
</div>
<div class="contents">
<div class="textblock"><h2><a class="anchor" id="Sec_Compat"></a>
Demo Compatibility:</h2>
<p>The following list indicates what microcontrollers are compatible with this demo.</p>
<ul>
<li>Series 7 USB AVRs (AT90USBxxx7)</li>
<li>Series 6 USB AVRs (AT90USBxxx6)</li>
<li>Series 4 USB AVRs (ATMEGAxxU4)</li>
<li>Series 2 USB AVRs (AT90USBxx2, ATMEGAxxU2)</li>
</ul>
<h2><a class="anchor" id="Sec_Info"></a>
USB Information:</h2>
<p>The following table gives a rundown of the USB utilization of this demo.</p>
<table class="doxtable">
<tr>
<td><b>USB Mode:</b> </td><td>Device  </td></tr>
<tr>
<td><b>USB Class:</b> </td><td>Communications Device Class (CDC)  </td></tr>
<tr>
<td><b>USB Subclass:</b> </td><td>Abstract Control Model (ACM)  </td></tr>
<tr>
<td><b>Relevant Standards:</b> </td><td>USBIF CDC Class Standard  </td></tr>
<tr>
<td><b>Usable Speeds:</b> </td><td>Full Speed Mode  </td></tr>
</table>
<h2><a class="anchor" id="Sec_Description"></a>
Project Description:</h2>
<p>This bootloader enumerates to the host as a CDC Class device (virtual serial port), allowing for AVR109 protocol compatible programming software to load firmware onto the AVR.</p>
<p>Out of the box this bootloader builds for the USB1287, and will fit into 4KB of bootloader space. If you wish to enlarge this space and/or change the AVR model, you will need to edit the BOOT_START and MCU values in the accompanying makefile.</p>
<p>When the bootloader is running, the board's LED(s) will flash at regular intervals to distinguish the bootloader from the normal user application.</p>
<h2><a class="anchor" id="Sec_Installation"></a>
Driver Installation</h2>
<p>After running this bootloader for the first time on a new computer, you will need to supply the .INF file located in this bootloader project's directory as the device's driver when running under Windows. This will enable Windows to use its inbuilt CDC drivers, negating the need for custom drivers for the device. Other Operating Systems should automatically use their own inbuilt CDC-ACM drivers.</p>
<h2><a class="anchor" id="Sec_HostApp"></a>
Host Controller Application</h2>
<p>This bootloader is compatible with the open source application AVRDUDE, Atmel's AVRPROG, or other applications implementing the AVR109 protocol, which is documented on the Atmel website as an application note.</p>
<h3><a class="anchor" id="SSec_AVRDude"></a>
AVRDUDE (Windows, Mac, Linux)</h3>
<p>AVRDude is a free, cross-platform and open source command line programmer for Atmel and third party AVR programmers. It is available on the the Windows platform as part of the "WinAVR" package, or on other systems either from a build from the official source code, or in many distributions as a precompiled binary package.</p>
<p>To load a new HEX file with AVRDude, specify "AVR109" as the programmer, with the allocated COM port. On Windows platforms this will be a COMx port name: </p>
<div class="fragment"><pre class="fragment">  avrdude -c AVR109 -p at90usb1287 -P COM0 -U flash:w:Mouse.hex
</pre></div><p>On Linux systems, this will typically be a /dev/ttyACMx port name: </p>
<div class="fragment"><pre class="fragment">  avrdude -c AVR109 -p at90usb1287 -P /dev/ttyACM0 -U flash:w:Mouse.hex
</pre></div><p>Refer to the AVRDude project documentation for additional usage instructions.</p>
<h2><a class="anchor" id="Sec_API"></a>
User Application API</h2>
<p>Several user application functions for FLASH and other special memory area manipulations are exposed by the bootloader, allowing the user application to call into the bootloader at runtime to read and write FLASH data.</p>
<p>By default, the bootloader API jump table is located 32 bytes from the end of the device's FLASH memory, and follows the following layout:</p>
<div class="fragment"><pre class="fragment"><span class="preprocessor">  #define BOOTLOADER_API_START(Index)        (void*)(((FLASHEND - 32) + (2 * Index)) / 2)</span>
<span class="preprocessor"></span>  void    (*<a class="code" href="a00002.html#a24b83742d50698da694228c7e22430ad">BootloaderAPI_ErasePage</a>)(uint32_t Address)               = BOOTLOADER_API_START(0);
  void    (*<a class="code" href="a00002.html#a658514e1b5e6ea2ce0961f6f7e02dffb">BootloaderAPI_WritePage</a>)(uint32_t Address)               = BOOTLOADER_API_START(1);
  void    (*<a class="code" href="a00002.html#a56546f3c50d0a6df07c807034abaa9c6">BootloaderAPI_FillWord</a>)(uint32_t Address, uint16_t Word) = BOOTLOADER_API_START(2);
  uint8_t (*<a class="code" href="a00002.html#a5438f1b6859128f5e49e7e48ac2edd5d">BootloaderAPI_ReadSignature</a>)(uint16_t Address)           = BOOTLOADER_API_START(3);
  uint8_t (*<a class="code" href="a00002.html#a75fda26274bb7f8eb5ab4ec7f18480a6">BootloaderAPI_ReadFuse</a>)(uint16_t Address)                = BOOTLOADER_API_START(4);
  uint8_t (*<a class="code" href="a00002.html#a1d07523558f9d43e46b4d7c7aead42bd">BootloaderAPI_ReadLock</a>)(void)                            = BOOTLOADER_API_START(5);
  void    (*<a class="code" href="a00002.html#a7bbe71ef5d5ca96c3beee81c76ac427a">BootloaderAPI_WriteLock</a>)(uint8_t LockBits)               = BOOTLOADER_API_START(6);

<span class="preprocessor">  #define BOOTLOADER_SIG_START               (FLASHEND - 32)</span>
<span class="preprocessor">  #define BOOTLOADER_SIGNATURE               0xDCFB</span>
</pre></div><p>Bootloaders reporting a device release revision number of 1.00 or greater are bootloader API enabled. From the application the API support of the bootloader can be detected by reading the FLASH memory bytes located at address <code>BOOTLOADER_SIG_START</code> and comparing them to the value <code>BOOTLOADER_SIGNATURE</code>.</p>
<h2><a class="anchor" id="Sec_Options"></a>
Project Options</h2>
<p>The following defines can be found in this demo, which can control the demo behaviour when defined, or changed in value.</p>
<table class="doxtable">
<tr>
<td><b>Define Name:</b> </td><td><b>Location:</b> </td><td><b>Description:</b>  </td></tr>
<tr>
<td>NO_BLOCK_SUPPORT </td><td>Makefile LUFA_OPTS </td><td>Define to disable memory block read/write support in the bootloader, requiring all reads and writes to be made using the byte-level commands.  </td></tr>
<tr>
<td>NO_EEPROM_BYTE_SUPPORT </td><td>Makefile LUFA_OPTS </td><td>Define to disable EEPROM memory byte read/write support in the bootloader, requiring all EEPROM reads and writes to be made using the block-level commands.  </td></tr>
<tr>
<td>NO_FLASH_BYTE_SUPPORT </td><td>Makefile LUFA_OPTS </td><td>Define to disable FLASH memory byte read/write support in the bootloader, requiring all FLASH reads and writes to be made using the block-level commands.  </td></tr>
<tr>
<td>NO_LOCK_BYTE_WRITE_SUPPORT </td><td>Makefile LUFA_OPTS </td><td>Define to disable lock byte write support in the bootloader, preventing the lock bits from being set programmatically.  </td></tr>
</table>
</div></div>
</div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="footer">Generated by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.3 </li>
    </ul>
  </div>

</body>
</html>
