<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>LUFA Library - DFU Class Bootloader: DFU Class USB AVR Bootloader</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript">
$(document).ready(initResizable);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.3 -->
<script type="text/javascript">
function hasClass(ele,cls) {
  return ele.className.match(new RegExp('(\\s|^)'+cls+'(\\s|$)'));
}

function addClass(ele,cls) {
  if (!this.hasClass(ele,cls)) ele.className += " "+cls;
}

function removeClass(ele,cls) {
  if (hasClass(ele,cls)) {
    var reg = new RegExp('(\\s|^)'+cls+'(\\s|$)');
    ele.className=ele.className.replace(reg,' ');
  }
}

function toggleVisibility(linkObj) {
 var base = linkObj.getAttribute('id');
 var summary = document.getElementById(base + '-summary');
 var content = document.getElementById(base + '-content');
 var trigger = document.getElementById(base + '-trigger');
 if ( hasClass(linkObj,'closed') ) {
   summary.style.display = 'none';
   content.style.display = 'block';
   trigger.src = 'open.png';
   removeClass(linkObj,'closed');
   addClass(linkObj,'opened');
 } else if ( hasClass(linkObj,'opened') ) {
   summary.style.display = 'block';
   content.style.display = 'none';
   trigger.src = 'closed.png';
   removeClass(linkObj,'opened');
   addClass(linkObj,'closed');
 }
 return false;
}
</script>
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">LUFA Library - DFU Class Bootloader&#160;<span id="projectnumber">0.0.0</span></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li class="current"><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('index.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<h1>DFU Class USB AVR Bootloader </h1>  </div>
</div>
<div class="contents">
<div class="textblock"><h2><a class="anchor" id="Sec_Compat"></a>
Demo Compatibility:</h2>
<p>The following list indicates what microcontrollers are compatible with this demo.</p>
<ul>
<li>Series 7 USB AVRs (AT90USBxxx7)</li>
<li>Series 6 USB AVRs (AT90USBxxx6)</li>
<li>Series 4 USB AVRs (ATMEGAxxU4)</li>
<li>Series 2 USB AVRs (AT90USBxx2, ATMEGAxxU2)</li>
</ul>
<h2><a class="anchor" id="Sec_Info"></a>
USB Information:</h2>
<p>The following table gives a rundown of the USB utilization of this demo.</p>
<table class="doxtable">
<tr>
<td><b>USB Mode:</b> </td><td>Device  </td></tr>
<tr>
<td><b>USB Class:</b> </td><td>Device Firmware Update Class (DFU)  </td></tr>
<tr>
<td><b>USB Subclass:</b> </td><td>None  </td></tr>
<tr>
<td><b>Relevant Standards:</b> </td><td>USBIF DFU Class Standard, Atmel USB Bootloader Datasheet  </td></tr>
<tr>
<td><b>Usable Speeds:</b> </td><td>Full Speed Mode  </td></tr>
</table>
<h2><a class="anchor" id="Sec_Description"></a>
Project Description:</h2>
<p>This bootloader enumerates to the host as a DFU Class device, allowing for DFU-compatible programming software to load firmware onto the AVR.</p>
<p>Out of the box this bootloader builds for the USB1287, and should fit into 4KB of bootloader space. If you wish to enlarge this space and/or change the AVR model, you will need to edit the BOOT_START and MCU values in the accompanying makefile.</p>
<p>When the bootloader is running, the board's LED(s) will flash at regular intervals to distinguish the bootloader from the normal user application.</p>
<h2><a class="anchor" id="Sec_Installation"></a>
Driver Installation</h2>
<p>This bootloader is designed to be compatible with Atmel's provided Windows DFU class drivers. You will need to install Atmel's DFU drivers prior to using this bootloader on Windows platforms. If you are using a 64 bit Windows OS, you will need to either disable the driver signing requirement (see online tutorials for details) or use a digitally signed version of the official Atmel driver provided by a third party AVR user at <a href="http://www.avrfreaks.net/index.php?module=Freaks%20Academy&func=viewItem&item_id=2196&item_type=project">http://www.avrfreaks.net/index.php?module=Freaks%20Academy&amp;func=viewItem&amp;item_id=2196&amp;item_type=project</a>.</p>
<dl class="note"><dt><b>Note:</b></dt><dd>This device spoofs Atmel's DFU Bootloader USB VID and PID so that the Atmel DFU bootloader drivers included with FLIP will work. If you do not wish to use Atmel's ID codes, please manually change them in <a class="el" href="a00009.html">Descriptors.c</a> and alter your driver's INF file accordingly.</dd></dl>
<h2><a class="anchor" id="Sec_HostApp"></a>
Host Controller Application</h2>
<p>This bootloader is compatible with Atmel's FLIP utility on Windows machines, and dfu-programmer on Linux machines.</p>
<h3><a class="anchor" id="SSec_FLIP"></a>
FLIP (Windows)</h3>
<p>FLIP (Flexible In-System Programmer) is a utility written by Atmel, and distributed for free on the Atmel website. The FLIP utility is designed to assist in the bootloader programming of a range of Atmel devices, through several popular physical interfaces including USB. It is written in Java, however makes use of native extensions for USB support and thus is only offered on Windows.</p>
<p>To program a device using FLIP, refer to the Atmel FLIP documentation.</p>
<h3><a class="anchor" id="SSec_DFUProgrammer"></a>
dfu-programmer (Linux)</h3>
<p>dfu-programmer is an open-source command line solution for the bootloader programming of Atmel devices through a USB connection, using the DFU protocol, available for download at <a href="http://sourceforge.net/projects/dfu-programmer/">http://sourceforge.net/projects/dfu-programmer/</a>.</p>
<p>The following example loads a HEX file into the AVR's FLASH memory using dfu-programmer: </p>
<div class="fragment"><pre class="fragment">  dfu-programmer at90usb1287 erase flash Mouse.hex
</pre></div><h2><a class="anchor" id="Sec_API"></a>
User Application API</h2>
<p>Several user application functions for FLASH and other special memory area manipulations are exposed by the bootloader, allowing the user application to call into the bootloader at runtime to read and write FLASH data.</p>
<dl class="note"><dt><b>Note:</b></dt><dd>The APIs exposed by the DFU class bootloader are <b>NOT</b> compatible with the API exposed by the official Atmel DFU bootloader.</dd></dl>
<p>By default, the bootloader API jump table is located 32 bytes from the end of the device's FLASH memory, and follows the following layout:</p>
<div class="fragment"><pre class="fragment"><span class="preprocessor">  #define BOOTLOADER_API_START(Index)        (void*)(((FLASHEND - 32) + (2 * Index)) / 2)</span>
<span class="preprocessor"></span>  void    (*<a class="code" href="a00004.html#a24b83742d50698da694228c7e22430ad">BootloaderAPI_ErasePage</a>)(uint32_t Address)               = BOOTLOADER_API_START(0);
  void    (*<a class="code" href="a00004.html#a658514e1b5e6ea2ce0961f6f7e02dffb">BootloaderAPI_WritePage</a>)(uint32_t Address)               = BOOTLOADER_API_START(1);
  void    (*<a class="code" href="a00004.html#a56546f3c50d0a6df07c807034abaa9c6">BootloaderAPI_FillWord</a>)(uint32_t Address, uint16_t Word) = BOOTLOADER_API_START(2);
  uint8_t (*<a class="code" href="a00004.html#a5438f1b6859128f5e49e7e48ac2edd5d">BootloaderAPI_ReadSignature</a>)(uint16_t Address)           = BOOTLOADER_API_START(3);
  uint8_t (*<a class="code" href="a00004.html#a75fda26274bb7f8eb5ab4ec7f18480a6">BootloaderAPI_ReadFuse</a>)(uint16_t Address)                = BOOTLOADER_API_START(4);
  uint8_t (*<a class="code" href="a00004.html#a1d07523558f9d43e46b4d7c7aead42bd">BootloaderAPI_ReadLock</a>)(void)                            = BOOTLOADER_API_START(5);
  void    (*<a class="code" href="a00004.html#a7bbe71ef5d5ca96c3beee81c76ac427a">BootloaderAPI_WriteLock</a>)(uint8_t LockBits)               = BOOTLOADER_API_START(6);

<span class="preprocessor">  #define BOOTLOADER_SIG_START               (FLASHEND - 32)</span>
<span class="preprocessor">  #define BOOTLOADER_SIGNATURE               0xDCFB</span>
</pre></div><p>From the application the API support of the bootloader can be detected by reading the FLASH memory bytes located at address <code>BOOTLOADER_SIG_START</code> and comparing them to the value <code>BOOTLOADER_SIGNATURE</code>.</p>
<h2><a class="anchor" id="Sec_Options"></a>
Project Options</h2>
<p>The following defines can be found in this demo, which can control the demo behaviour when defined, or changed in value.</p>
<table class="doxtable">
<tr>
<td><b>Define Name:</b> </td><td><b>Location:</b> </td><td><b>Description:</b>  </td></tr>
<tr>
<td>SECURE_MODE </td><td><a class="el" href="a00007.html">BootloaderDFU.h</a> </td><td>If defined to true, the bootloader will not accept any memory commands other than a chip erase on start-up, until an erase has been performed. This can be used in conjunction with the AVR's lockbits to prevent the AVRs firmware from being dumped by unauthorized persons.  </td></tr>
</table>
</div></div>
</div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="footer">Generated by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.3 </li>
    </ul>
  </div>

</body>
</html>
